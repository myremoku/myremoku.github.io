<html>
    <head>
        <title>myremoku</title>
        <script>
            var rokuIp = location.hash.slice(1);

            function bake_json_cookie(name, value) {
                var cookie = [name, '=', JSON.stringify(value), '; domain=.', window.location.host.toString(), '; path=/;'].join(
                    ''
                );
                document.cookie = cookie;
            }
            function read_json_cookie(name) {
                var result = document.cookie.match(new RegExp(name + '=([^;]+)'));
                result && (result = JSON.parse(result[1]));
                return result;
            }

            if( rokuIp == '' ) {
                rokuIp = read_json_cookie('rokuIp') || '';
                const url = new URL(window.location);
                url.hash = '#' + rokuIp;
                history.replaceState(
                    {}
                    ,document.title
                    ,url
                );
            }
            else {
                bake_json_cookie('rokuIp',rokuIp)
            }

            function onBodyLoad() {
                document.addEventListener('keydown', (e) => {
                    console.log( `event.type=[${event.type}] .key=[${event.key}] .keyCode=[${event.keyCode}] .code=[${event.code}] .altKey=[${event.altKey}] .ctrlKey=[${event.ctrlKey}]` );
                    if (event.metaKey || ['Shift', 'Meta'].includes(event.key)) return;
                    // Roku Extended Control Protocol (ECP) documentation:
                    // https://developer.roku.com/docs/developer-program/debugging/external-control-api.md
                    // Keypress key values:
                    // https://developer.roku.com/docs/developer-program/debugging/external-control-api.md#keypress-key-values
                    var nonLitKeys = {
                        ArrowDown: 'Down',
                        ArrowLeft: 'Left',
                        ArrowUp: 'Up',
                        ArrowRight: 'Right',
                        Backspace: 'Backspace',
                        Enter: 'Select',
                        Home: 'Home',
                        ' ': 'LIT_%20'
                    };
                    if( event.altKey || event.ctrlKey) {
                       if( event.key == 'ArrowLeft' ) postToRoku('Back', event);
                       if( event.key == 'ArrowUp' ) postToRoku('VolumeUp', event);
                       if( event.key == 'ArrowDown' ) postToRoku('VolumeDown', event);
                    }
                    else postToRoku( nonLitKeys[event.key] || 'LIT_' + event.key, event);
                });
            }
            function postToRoku(keyPath, event, keyDir) {
                var f = document.all.form4Posting;
                f.action = 'http://' + rokuIp + ':8060/' + (!keyDir ? 'keypress' : keyDir) + '/' + keyPath;
                console.log(`Posting to "${f.action}"`);
                f.submit();
            }
        </script>
        <style>
            div {
                font-size: xxx-large;
                display: flex;
                justify-content: center;
                align-items: center;
                height: 75px;
                color: #dddddd;
            }
            span {
                cursor: pointer;
            }
            span + span {
                margin-left: 75px;
            }
        </style>
    </head>
    <body bgcolor="#000000" onload="onBodyLoad()">
        <form></form>
        <div>
            <span onclick="postToRoku('PowerOff')" title="Power Off">‚åΩ</span>
        </div>
        <div>
            <span onclick="postToRoku('Home')" title="Home">‚åÇ</span>
            <span onclick="postToRoku('VolumeUp')" title="Volume Up (Ctrl + Up Arrow)">üîä</span>
        </div>
        <div>
            <span onclick="postToRoku('Back')" title="Back (Ctrl + Left Arrow)">‚Üê</span>
            <span onclick="postToRoku('VolumeDown')" title="Volume Down (Ctrl + Down Arrow)">üîâ</span>
        </div>
        <div>
            <span onclick="postToRoku('Info',null,'keydown')" title="Info">‚ìò</span>
        </div>
        <div>
            <span onclick="postToRoku('Rev')" title="Reverse">‚è™Ô∏è</span>
            <span onclick="postToRoku('Play')" title="Play">‚ñ∂Ô∏è</span>
            <span onclick="postToRoku('Fwd')" title="Forward">‚è©Ô∏è</span>
        </div>
        <iframe name="if4roku" style="display: none;"></iframe>
        <form id="form4Posting" target="if4roku" method="POST"></form>
    </body>
</html>
